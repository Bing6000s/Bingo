"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const g=require("fs"),w=require("uuid"),f=require("./helper.cjs"),A=o=>o&&o.__esModule?o:{default:o},P=A(g),C=(o,i,c)=>new Promise((e,r)=>{typeof i=="object"?a(o,i,c).then(()=>{e({status:!0,message:"Collection successfully imported!"})}).catch(s=>{r({status:!1,message:s.message})}):P.default.readFile(i,"utf8",function(n,s){n&&(console.log(n),r({status:!1,message:n.message}));let t=JSON.parse(s);a(o,t,c).then(()=>{e({status:!0,message:"Collection successfully imported!"})}).catch(l=>{r({status:!1,message:l.message})})})}),a=async(o,i,c={})=>{for(const e in i){let r=e;for(const n in i[e])if(i[e].hasOwnProperty(n)){let s=Array.isArray(i[e])?w.v1():n;if(Array.isArray(i[e])){const t=i[e][n].subCollection;if(delete i[e][n].subCollection,await h(o,r,s,i[e][n],c),t)for(const l in t){const y={},u=`${r}/${s}/${l}`;y[u]=t[l],await a(o,y,c)}}else{const t=i[e][s].subCollection;delete i[e][n].subCollection;try{await h(o,r,s,i[e][n],c)}catch(l){console.error(l)}t&&await a(o,t,c)}}}},h=(o,i,c,e,r)=>{var n;return r.dates&&r.dates.length>0&&r.dates.forEach(s=>{e.hasOwnProperty(s)&&(Array.isArray(e[s])?e[s]=e[s].map(t=>f.makeTime(t)):e[s]=f.makeTime(e[s])),s.indexOf(".")>-1&&f.traverseObjects(e,t=>t.hasOwnProperty("_seconds")?f.makeTime(t):null)}),r.autoParseDates&&f.parseAndConvertDates(e),(n=r.refs)!=null&&n.length&&r.refs.forEach(s=>{e.hasOwnProperty(s)?Array.isArray(e[s])?e[s]=e[s].map(t=>o.doc(t)):e[s]=o.doc(e[s]):e.hasOwnProperty(s.split(".")[0])&&s.split(".").reduce((t,l,y)=>{if(Array.isArray(t))return t.reduce((u,m)=>{if(typeof m[l]=="string")m[l]=o.doc(m[l]);else return typeof m[l]=="object"?u=m[l]:u},{});if(Array.isArray(t[l])&&s.split(".").length===y+1)t[l]=t[l].map(u=>o.doc(u));else return s.split(".").length===y+1&&t[l]?t[l]=o.doc(t[l]):t[l]=t[l]||null},e)}),r.geos&&r.geos.length>0&&r.geos.forEach(s=>{e.hasOwnProperty(s)&&(Array.isArray(e[s])?e[s]=e[s].map(t=>f.makeGeoPoint(t)):e[s]=f.makeGeoPoint(e[s])),s.indexOf(".")>-1&&f.traverseObjects(e,t=>t.hasOwnProperty("_latitude")?f.makeGeoPoint(t):null)}),r.autoParseGeos&&f.parseAndConvertGeos(e),new Promise((s,t)=>{o.collection(i).doc(c).set(e).then(()=>{r!=null&&r.showLogs&&console.log(`${c} was successfully added to firestore!`),s({status:!0,message:`${c} was successfully added to firestore!`})}).catch(l=>{console.log(l),t({status:!1,message:l.message})})})};exports.restoreService=C;
